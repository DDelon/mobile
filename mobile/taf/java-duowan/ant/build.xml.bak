<?xml version="1.0" encoding="UTF-8"?>
<project basedir="../../" default="all">
	<property file="build.properties" />

	<!-- source -->
	<property name="dir.src.root" location="." />
	<property name="dir.src" location="java/jce/src" />
	<property name="dir.dist" value="java/dist" />
	<property name="dir.lib" value="java/lib" />
	<property name="dir.build" value="java/build" />
	<property name="dir.build.src" value="java/build/src" />
	<property name="version.major"         value="1" />
	<property name="version.minor"         value="2" />
	<property name="version.build"         value="29" />
	<property name="version"               value="1.2.29" />
	<property name="version.number"        value="${version.major}.${version.minor}.${version.build}" />

	<target name="clean">
		<delete dir="${dir.build}" />
	</target>

	<target name="init" depends="clean">
		<mkdir dir="${dir.build}" />	
		<mkdir dir="${dir.dist}" />
	</target>

	<path id="libs">
		<fileset dir="${dir.lib}" includes="**/*.jar" />
	</path>

	<target name="compile" depends="init">
		<javac srcdir="${dir.src}" target="1.5" destdir="${dir.build}" debug="true" encoding="UTF-8">
			<classpath refid="libs">
			</classpath>
		</javac>
	</target>

	<target name="buildjar" depends="compile">
	    <tstamp>      
	      <format property="TimeSign" pattern="yyyy-MM-dd HH:mm:ss" />
	    </tstamp>   
	    <filter token="VERSION" value="${version}"/>
	    <filter token="VERSION_NUMBER" value="${version.number}"/>
	    <filter token="VERSION_BUILT" value="${TimeSign}"/>
		
		<copy todir="${dir.build.src}" filtering="true">
				<fileset dir="${dir.src}">
					<exclude name="com/qq/taf/jce/**" />
					<exclude name="com/qq/taf/RequestPacket.java" />
					<exclude name="com/qq/jce/wup/**.java" />
				</fileset>
		</copy>
		<copy todir="${dir.build}" filtering="true">
					<fileset dir="${dir.src}">
						<include name="**/*.properties" />
					</fileset>
		</copy>
		<jar destfile="${dir.dist}/taf-proxy-1.0.0-SNAPSHOT.jar" basedir="${dir.build}" manifest="${dir.src}/manifest">
			<exclude name="src/com/qq/taf/jce/**" />
			<exclude name="src/com/qq/taf/RequestPacket.java" />
			<exclude name="src/com/qq/jce/wup/**.java" />
			<exclude name="src/com/qq/jce/wup/*.properties" />
			<exclude name="com/qq/taf/jce/**" />
			<exclude name="com/qq/taf/RequestPacket.class" />
			<exclude name="com/qq/jce/wup/**.class" />
			<exclude name="com/qq/jce/wup/*.properties" />
			<manifest>
				<attribute name="BuildTime" value="${TimeSign}" />
			</manifest>
		</jar>
	</target>

	<target name="all" depends="buildjar">
	</target>
</project>